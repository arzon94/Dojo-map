// COPYRIGHT © 2017 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.4/esri/copyright.txt for details.

define(["require","exports","../geometry/Geometry","../moment","dojo/number","./ImmutableArray","../kernel","./ImmutablePointArray","./ImmutablePathArray","dojo/_base/array","../geometry/Point","../geometry/Polyline","../geometry/Polygon","../geometry/Extent","../geometry/Multipoint","./FunctionWrapper"],function(n,e,r,t,i,u,o,a,l,f,c,s,d,m,g,v){function p(n,e,r){if(""===e)return n;if(null===e)return n;if(void 0===e)return n;if(e===r)return n;if(e===r)return n;do n=n.replace(e,r);while(-1!==n.indexOf(e));return n}function y(n){return n instanceof Y||n instanceof v||n instanceof Z}function x(n){return N(n)?!0:O(n)?!0:C(n)?!0:T(n)?!0:null===n?!0:n===e.voidOperation?!0:"number"==typeof n?!0:!1}function h(n,e){return void 0===n?e:n}function N(n){return"string"==typeof n||n instanceof String}function T(n){return"boolean"==typeof n}function O(n){return"number"==typeof n}function b(n){return n instanceof Array}function S(n){return n&&void 0!==n.isFeatureCursor}function I(n){return n instanceof u}function C(n){return n instanceof Date}function _(n,e,r){if(n.length<e||n.length>r)throw new Error("Function called with wrong number of Parameters")}function j(){var n=(new Date).getTime(),e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var r=(n+16*Math.random())%16|0;return n=Math.floor(n/16),("x"===e?r:3&r|8).toString(16)});return e}function D(n,e){return isNaN(n)===!1?void 0===e||null===e||""===e?n.toString():(e=p(e,"‰",""),e=p(e,"¤",""),i.format(n,{pattern:e})):n.toString()}function F(n,e){var r=t(n);return void 0===e||null===e||""===e?r.format():r.format(V(e))}function V(n){var e=n.replace(/(LTS)|L|l/g,function(n){return"["+n+"]"});return e}function R(n,e,r){switch(r){case">":return n>e;case"<":return e>n;case">=":return n>=e;case"<=":return e>=n}return!1}function w(n,r,t){if(null===n){if(null===r||r===e.voidOperation)return R(null,null,t);if(O(r))return R(0,r,t);if(N(r))return R(0,E(r),t);if(T(r))return R(0,E(r),t);if(C(r))return R(0,r.getTime(),t)}if(n===e.voidOperation){if(null===r||r===e.voidOperation)return R(null,null,t);if(O(r))return R(0,r,t);if(N(r))return R(0,E(r),t);if(T(r))return R(0,E(r),t);if(C(r))return R(0,r.getTime(),t)}else if(O(n)){if(O(r))return R(n,r,t);if(T(r))return R(n,E(r),t);if(null===r||r===e.voidOperation)return R(n,0,t);if(N(r))return R(n,E(r),t);if(C(r))return R(n,r.getTime(),t)}else if(N(n)){if(N(r))return R(P(n),P(r),t);if(C(r))return R(E(n),r.getTime(),t);if(O(r))return R(E(n),r,t);if(null===r||r===e.voidOperation)return R(E(n),0,t);if(T(r))return R(E(n),E(r),t)}else if(C(n)){if(C(r))return R(n,r,t);if(null===r||r===e.voidOperation)return R(n.getTime(),0,t);if(O(r))return R(n.getTime(),r,t);if(T(r))return R(n.getTime(),E(r),t);if(N(r))return R(n.getTime(),E(r),t)}else if(T(n)){if(T(r))return R(n,r,t);if(O(r))return R(E(n),E(r),t);if(C(r))return R(E(n),r.getTime(),t);if(null===r||r===e.voidOperation)return R(E(n),0,t);if(N(r))return R(E(n),E(r),t)}return A(n,r)&&("<="===t||">="===t)?!0:!1}function A(n,r){if(n===r)return!0;if(null===n&&r===e.voidOperation||null===r&&n===e.voidOperation)return!0;if(C(n)&&C(r))return n.getTime()===r.getTime();if(n instanceof l)return n.equalityTest(r);if(n instanceof a)return n.equalityTest(r);if(n instanceof c&&r instanceof c){var t=void 0,i=void 0;if(e.isVersion4?(t=n.cache._arcadeCacheId,i=r.cache._arcadeCacheId):(t=n.getCacheValue("_arcadeCacheId"),i=r.getCacheValue("_arcadeCacheId")),void 0!==t&&null!==t)return t===i}if(void 0!==n&&void 0!==r&&null!==n&&null!==r&&"object"==typeof n&&"object"==typeof r){if(n._arcadeCacheId===r._arcadeCacheId&&void 0!==n._arcadeCacheId&&null!==n._arcadeCacheId)return!0;if(n._underlyingGraphic===r._underlyingGraphic&&void 0!==n._underlyingGraphic&&null!==n._underlyingGraphic)return!0}return!1}function P(n,t){if(N(n))return n;if(null===n)return"";if(O(n))return D(n,t);if(T(n))return n.toString();if(C(n))return F(n,t);if(n instanceof r)return JSON.stringify(n.toJSON());if(b(n)){for(var i=[],o=0;o<n.length;o++)i[o]=L(n[o]);return"["+i.join(",")+"]"}if(n instanceof u){for(var i=[],o=0;o<n.length();o++)i[o]=L(n.get(o));return"["+i.join(",")+"]"}return null!==n&&"object"==typeof n&&void 0!==n.castToText?n.castToText():y(n)?"object, Function":(n===e.voidOperation,"")}function G(n){var e=[];if(b(n)===!1)return null;if(n instanceof u){for(var r=0;r<n.length();r++)e[r]=E(n.get(r));return e}for(var r=0;r<n.length;r++)e[r]=E(n[r]);return e}function J(n,t){if(N(n))return n;if(null===n)return"";if(O(n))return D(n,t);if(T(n))return n.toString();if(C(n))return F(n,t);if(n instanceof r)return JSON.stringify(n.toJSON());if(b(n)){for(var i=[],o=0;o<n.length;o++)i[o]=L(n[o]);return"["+i.join(",")+"]"}if(n instanceof u){for(var i=[],o=0;o<n.length();o++)i[o]=L(n.get(o));return"["+i.join(",")+"]"}return null!==n&&"object"==typeof n&&void 0!==n.castToText?n.castToText():y(n)?"object, Function":(n===e.voidOperation,"")}function L(n){if(null===n)return"null";if(T(n)||O(n)||N(n))return JSON.stringify(n);if(n instanceof r)return J(n);if(n instanceof u)return J(n);if(n instanceof Array)return J(n);if(n instanceof Date)return JSON.stringify(F(n,""));if(null!==n&&"object"==typeof n){if(void 0!==n.castToText)return n.castToText()}else if(n===e.voidOperation)return"null";return"null"}function E(n,r){return O(n)?n:null===n?0:""===n?0:C(n)?NaN:T(n)?n?1:0:b(n)?NaN:""===n?NaN:void 0===n?NaN:void 0!==r&&N(n)?(r=p(r,"‰",""),r=p(r,"¤",""),i.parse(n,{pattern:r})):n===e.voidOperation?0:Number(n)}function M(n,e){if(C(n))return n;if(N(n)){var r=t(n,[void 0===e||null===e||""===e?t.ISO_8601:e]);if(r.isValid())return r.toDate()}return null}function q(n,e){if(C(n))return t(n);if(N(n)){var r=t(n,[void 0===e||null===e||""===e?t.ISO_8601:e]);if(r.isValid())return r}return null}function U(n){return T(n)?n:N(n)?(n=n.toLowerCase(),"true"===n?!0:!1):O(n)?0===n?!1:isNaN(n)?!1:!0:!1}function k(n,e){return null===n||void 0===n?null:((null===n.spatialReference||void 0===n.spatialReference)&&(n.spatialReference=e),n)}function B(n){return null===n?null:n instanceof c?"NaN"===n.x||null===n.x||isNaN(n.x)?null:n:n instanceof d?0===n.rings.length?null:n:n instanceof s?0===n.paths.length?null:n:n instanceof g?0===n.points.length?null:n:n instanceof m?"NaN"===n.xmin||null===n.xmin||isNaN(n.xmin)?null:n:null}function z(n,e){if(!n)return null;if(!n.domain)return null;var r=null;e="string"===n.field.type||"esriFieldTypeString"===n.field.type?P(e):E(e);for(var t=0;t<n.domain.codedValues.length;t++){var i=n.domain.codedValues[t];i.code===e&&(r=i)}return null===r?null:r.name}function K(n,e){if(!n)return null;if(!n.domain)return null;var r=null;e=P(e);for(var t=0;t<n.domain.codedValues.length;t++){var i=n.domain.codedValues[t];i.name===e&&(r=i)}return null===r?null:r.code}function W(n,e,r,t){if(void 0===r&&(r=null),!e)return null;if(!e.fields)return null;for(var i=null,u=0;u<e.fields.length;u++){var o=e.fields[u];o.name.toLowerCase()===n.toString().toLowerCase()&&(i=o)}if(null===i)return null;var a,l;return t||(t=r&&e.typeIdField&&r._field(e.typeIdField)),null!=t&&f.some(e.types,function(n){return n.id===t?(a=n.domains&&n.domains[i.name],a&&"inherited"===a.type&&(a=H(i.name,e),l=!0),!0):!1}),l||a||(a=H(n,e)),{field:i,domain:a}}function H(n,e){var r;return f.some(e.fields,function(e){return e.name===n&&(r=e.domain),!!r}),r}Object.defineProperty(e,"__esModule",{value:!0});var Q=function(){function n(n){this.value=n}return n}(),X=function(){function n(n){this.value=n}return n}(),Y=function(){function n(n){this.fn=n}return n}(),Z=function(){function n(n){this.fn=n}return n}();e.NativeFunction=Y,e.ImplicitResult=X,e.ReturnResult=Q,e.SizzleFunction=Z,e.isVersion4=0===o.version.indexOf("4."),e.voidOperation={type:"VOID"},e.breakResult={type:"BREAK"},e.continueResult={type:"CONTINUE"},e.multiReplace=p,e.isFunctionParameter=y,e.isSimpleType=x,e.defaultUndefined=h,e.isString=N,e.isBoolean=T,e.isNumber=O,e.isArray=b,e.isFeatureCursor=S,e.isImmutableArray=I,e.isDate=C,e.pcCheck=_,e.generateUUID=j,e.formatNumber=D,e.formatDate=F,e.standardiseDateFormat=V,e.greaterThanLessThan=w,e.equalityTest=A,e.toString=P,e.toNumberArray=G,e.toStringExplicit=J,e.toNumber=E,e.toDate=M,e.toDateM=q,e.toBoolean=U,e.fixSpatialReference=k,e.fixNullGeometry=B,e.getDomainValue=z,e.getDomainCode=K,e.getDomain=W});