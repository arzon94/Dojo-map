// COPYRIGHT Â© 2017 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.4/esri/copyright.txt for details.

define(["require","exports","../../../core/tsSupport/assignHelper","../../../core/tsSupport/declareExtendsHelper","../../../core/tsSupport/decorateHelper","../../../core/accessorSupport/decorators","../../../core/promiseUtils","../../../core/screenUtils","../../../symbols/support/symbolUtils","../../../symbols/support/symbolPreview","../../../Color","../../../core/Accessor","../../../request","../../../symbols/support/jsonUtils","../../../symbols/support/gfxUtils","dojo/dom-construct","dojo/i18n!../nls/SymbolStyler"],function(t,e,r,o,i,n,a,s,l,p,m,y,u,c,d,h,v){function b(t){var e=t.thumbnail.href,r=h.create("div");return u(e,{responseType:"image"}).then(function(t){return r.appendChild(t.data)}).otherwise(function(){var t=24,e=s.pt2px(t);h.create("img",{src:f,width:e,height:e,alt:""},r)}).then(function(){return r})}function S(t,e,r){var o={data:t,base:r.itemUrl,filename:"data",styleName:l.styleNameFromItem(r)};return l.fetchSymbolFromStyle(o,e,{portal:r.portal})}Object.defineProperty(e,"__esModule",{value:!0});var f=t.toUrl("../../../themes/base/images/broken-file-64.svg"),g=[{name:"Circle",type:"esriSMS",style:"esriSMSCircle",color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}},{name:"Square",type:"esriSMS",style:"esriSMSSquare",color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}},{name:"Diamond",type:"esriSMS",style:"esriSMSDiamond",color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}},{name:"Cross",type:"esriSMS",style:"esriSMSCross",color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}},{name:"X",type:"esriSMS",style:"esriSMSX",color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}}],w=10,I=5,_=[{name:v.circle,primitive:"circle"},{name:v.square,primitive:"square"},{name:v.cross,primitive:"cross"},{name:v.x,primitive:"x"},{name:v.kite,primitive:"kite"}],O=[{name:v.sphere,primitive:"sphere"},{name:v.tallCylinder,primitive:"cylinder",mixins:{width:I,height:w,depth:I}},{name:v.cylinder,primitive:"cylinder"},{name:v.tallCube,primitive:"cube",mixins:{width:I,height:w,depth:I,anchor:"bottom"}},{name:v.cube,primitive:"cube"},{name:v.tallCone,primitive:"cone",mixins:{width:I,height:w,depth:I}},{name:v.cone,primitive:"cone"},{name:v.invertedCone,primitive:"inverted-cone"},{name:v.diamond,primitive:"diamond"},{name:v.tetrahedron,primitive:"tetrahedron"}],C=_.map(function(t){return{dimensionality:"flat",title:t.name,type:"PointSymbol3D",symbolLayers:[{type:"Icon",resource:{primitive:t.primitive},material:{color:d.defaultThematicColor},outline:{color:[0,0,0]}}]}}),M=O.map(function(t){return{dimensionality:"volumetric",title:t.name,type:"PointSymbol3D",symbolLayers:[r({type:"Object",resource:{primitive:t.primitive}},t.mixins)]}}),D={getSymbol:function(t){var e=t.data,r=t.parentData,o=t.portalItem;return S(r,e.name,o).then(function(t){return"point-symbol-3d"===t.type&&t.symbolLayers.forEach(function(t){t.get("material.color")&&("icon"===t.type?t.material.color=d.defaultThematicColor.clone():"object"===t.type&&(t.material.color=new m([255,255,255])))}),t})},getThumbnail:function(t){return b(t.data)}},P={getSymbol:function(t){return a.resolve(c.fromJSON(t.data))},getThumbnail:function(t){var e=24;return t.getSymbol().then(function(t){return p.renderPreviewHTML(t,{size:e})})}},x={getSymbol:function(t){return a.resolve(c.fromJSON(t.data))},getThumbnail:function(t){var e=48;return t.getSymbol().then(function(t){return p.renderPreviewHTML(t,{size:e})})}},T=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.getSymbol=function(){var t=this;return this._symbol?a.resolve(this._symbol):this.strategy.getSymbol(this).then(function(e){return t._symbol=e})},e.prototype.getThumbnail=function(t){var e=this;return this._thumbnail?(t.appendChild(this._thumbnail),a.resolve()):this.strategy.getThumbnail(this).then(function(r){e._thumbnail=r,t.appendChild(e._thumbnail)})},e}(n.declared(y));i([n.property()],T.prototype,"strategy",void 0),i([n.property()],T.prototype,"data",void 0),i([n.property()],T.prototype,"parentData",void 0),i([n.property()],T.prototype,"portalItem",void 0),T=i([n.subclass("esri.widgets.SymbolStyler.SymbolItem")],T),e.SymbolItem=T;var j=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.fetchData=function(){var t=this;return this.data?a.resolve(this.data):this.portalItem.fetchData().then(function(e){return t._set("data",e),e})},e}(n.declared(y));i([n.property({readOnly:!0})],j.prototype,"data",void 0),i([n.property({aliasOf:"portalItem.id"})],j.prototype,"id",void 0),i([n.property({aliasOf:"portalItem.name"})],j.prototype,"name",void 0),i([n.property({aliasOf:"portalItem.title"})],j.prototype,"title",void 0),i([n.property()],j.prototype,"portalItem",void 0),j=i([n.subclass("esri.widgets.SymbolStyler.PortalItemSymbolSourceBase")],j);var z=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type="symbol-set",e}return o(e,t),e.prototype.getItems=function(){return a.resolve(null)},e}(n.declared(j));i([n.property({readOnly:!0})],z.prototype,"type",void 0),z=i([n.subclass("esri.widgets.SymbolStyler.SymbolSetSymbolSource")],z),e.SymbolSetSymbolSource=z;var U=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type="web-style",e}return o(e,t),e.prototype.getItems=function(){var t=this;return this._items?a.resolve(this._items):this.fetchData().then(function(e){return e.items.map(function(r){return new T({data:r,parentData:e,portalItem:t.portalItem,strategy:D})})}).then(function(e){return t._items=e})},e}(n.declared(j));i([n.property({readOnly:!0})],U.prototype,"type",void 0),U=i([n.subclass("esri.widgets.SymbolStyler.WebStyleSymbolSource")],U),e.WebStyleSymbolSource=U;var q=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.data=g,e.id="basic-symbol-set",e.name="Basic",e.title=v.basic,e.type="symbol-set",e}return o(e,t),e.prototype.getItems=function(){return a.resolve(null)},e}(n.declared(y));i([n.property()],q.prototype,"data",void 0),i([n.property()],q.prototype,"id",void 0),i([n.property()],q.prototype,"name",void 0),i([n.property()],q.prototype,"title",void 0),i([n.property({readOnly:!0})],q.prototype,"type",void 0),q=i([n.subclass("esri.widgets.SymbolStyler.BasicSymbolSetSource")],q),e.BasicSymbolSetSource=q;var B=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.data={items:C},e.id="basic-web-style:flat",e.name="Basic",e.title=v.basic,e.type="web-style",e}return o(e,t),e.prototype.getItems=function(){if(this._items)return a.resolve(this._items);var t=this.data.items.map(function(t){return new T({data:t,strategy:P})});return a.resolve(this._items=t)},e}(n.declared(y));i([n.property()],B.prototype,"data",void 0),i([n.property()],B.prototype,"id",void 0),i([n.property()],B.prototype,"name",void 0),i([n.property()],B.prototype,"title",void 0),i([n.property({readOnly:!0})],B.prototype,"type",void 0),B=i([n.subclass("esri.widgets.SymbolStyler.IconPrimitiveWebStyleSource")],B),e.IconPrimitiveWebStyleSource=B;var W=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.data={items:M},e.id="basic-web-style:volumetric",e.name="Basic",e.title=v.basic,e.type="web-style",e}return o(e,t),e.prototype.getItems=function(){var t=this;if(this._items)return a.resolve(this._items);var e=this.data.items.map(function(e){return new T({data:e,parentData:t.data,strategy:x})});return a.resolve(this._items=e)},e}(n.declared(y));i([n.property()],W.prototype,"data",void 0),i([n.property()],W.prototype,"id",void 0),i([n.property()],W.prototype,"name",void 0),i([n.property()],W.prototype,"title",void 0),i([n.property({readOnly:!0})],W.prototype,"type",void 0),W=i([n.subclass("esri.widgets.SymbolStyler.ObjectPrimitiveWebStyleSource")],W),e.ObjectPrimitiveWebStyleSource=W});