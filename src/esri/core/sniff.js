// COPYRIGHT Â© 2017 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.4/esri/copyright.txt for details.

define(["dojo/_base/window","dojo/sniff","../kernel"],function(r,e,i){function n(){if(b)return b;b={available:!1,version:0,supportsHighPrecisionFragment:!1};var r,e=function(r){for(var e=["webgl","experimental-webgl","webkit-3d","moz-webgl"],i=null,n=0;n<e.length;++n){try{i=r.getContext(e[n])}catch(t){}if(i)break}return i};try{if(!g.WebGLRenderingContext)throw 0;r=document.createElement("canvas")}catch(i){return b}var n=e(r);if(!n)return b;var t=n.getParameter(n.VERSION);if(!t)return b;var a=t.match(/^WebGL\s+([\d.]*)/);if(a){b.version=parseFloat(a[1]),b.available=b.version>=.94;var o=n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT);b.supportsHighPrecisionFragment=o&&o.precision>0,b.supportsVertexShaderSamplers=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0,b.supportsElementIndexUint=null!=n.getExtension("OES_element_index_uint")}return b}function t(){return!!n().available}function a(){return!!n().supportsHighPrecisionFragment}function o(){return!!n().supportsVertexShaderSamplers}function s(){return!!n().supportsElementIndexUint}if(e("host-node"))return e;var d,m=e("ff"),u=e("ie"),f=void 0===u&&e("trident")>=7,c=e("webkit"),l=e("opera"),x=e("chrome"),p=e("safari"),g=r.global,h=navigator.userAgent;if(d=h.match(/(iPhone|iPad|CPU)\s+OS\s+(\d+\_\d+)/i),d&&e.add("esri-iphone",parseFloat(d[2].replace("_","."))),d=h.match(/Android\s+(\d+\.\d+)/i),d&&e.add("esri-android",parseFloat(d[1])),d=h.match(/Fennec\/(\d+\.\d+)/i),d&&e.add("esri-fennec",parseFloat(d[1])),h.indexOf("BlackBerry")>=0&&h.indexOf("WebKit")>=0&&e.add("esri-blackberry",1),e.add("esri-touch",e("esri-iphone")||e("esri-android")||e("esri-blackberry")||e("esri-fennec")>=6||(m||c)&&document.createTouch?!0:!1),d=h.match(/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i),d&&e.add("esri-mobile",d),e.add("esri-pointer",navigator.pointerEnabled||navigator.msPointerEnabled),i._getDOMAccessor=function(r){var e="";return m?e="Moz":c?e="Webkit":u?e="ms":l&&(e="O"),e+r.charAt(0).toUpperCase()+r.substr(1)},e.add("esri-phonegap",!!g.cordova),e.add("esri-cors",e("esri-phonegap")||"XMLHttpRequest"in g&&"withCredentials"in new XMLHttpRequest),e.add("esri-canvas-svg-support",function(){return!(e("trident")||e("ie"))}),e("host-webworker"))return e;e.add("esri-workers",g.Worker?!0:!1),e.add("esri-transforms",f||u>=9||m>=3.5||x>=4||p>=3.1||l>=10.5||e("esri-iphone")>=3.2||e("esri-android")>=2.1),e.add("esri-transitions",f||u>=10||m>=4||x>=4||p>=3.1||l>=10.5||e("esri-iphone")>=3.2||e("esri-android")>=2.1),e.add("esri-transforms3d",f||m>=10||x>=12||p>=4||e("esri-iphone")>=3.2||e("esri-android")>=3),e.add("esri-url-encodes-apostrophe",function(){var r=g.document.createElement("a");return r.href="?'",r.href.indexOf("?%27")>-1}),e("esri-android")<3&&(e.add("esri-transforms",!1,!1,!0),e.add("esri-transitions",!1,!1,!0),e.add("esri-transforms3d",!1,!1,!0)),i._css=function(r){var i=e("esri-transforms3d");void 0!==r&&null!==r?i=r:i&&(x||p&&!e("esri-iphone"))&&(i=!1);var n=i?"translate3d(":"translate(",t=i?x?",-1px)":",0px)":")",a=i?"scale3d(":"scale(",o=i?",1)":")",s=i?"rotate3d(0,0,1,":"rotate(",d=i?"matrix3d(":"matrix(",f=i?",0,0,":",",g=i?",0,0,0,0,1,0,":",",h=i?",0,1)":")";return{names:{transition:c&&"-webkit-transition"||m&&"MozTransition"||l&&"OTransition"||u&&"msTransition"||"transition",transform:c&&"-webkit-transform"||m&&"MozTransform"||l&&"OTransform"||u&&"msTransform"||"transform",transformName:c&&"-webkit-transform"||m&&"-moz-transform"||l&&"-o-transform"||u&&"-ms-transform"||"transform",origin:c&&"-webkit-transform-origin"||m&&"MozTransformOrigin"||l&&"OTransformOrigin"||u&&"msTransformOrigin"||"transformOrigin",endEvent:c&&"webkitTransitionEnd"||m&&"transitionend"||l&&"oTransitionEnd"||u&&"MSTransitionEnd"||"transitionend"},translate:function(r,e){return n+r+"px,"+e+"px"+t},scale:function(r){return a+r+","+r+o},rotate:function(r){return s+r+"deg)"},matrix:function(r){return r.m?(r=r.m,d+r[0].toFixed(10)+","+r[1].toFixed(10)+f+r[2].toFixed(10)+","+r[3].toFixed(10)+g+r[4].toFixed(10)+(m?"px,":",")+r[5].toFixed(10)+(m?"px":"")+h):d+r.xx.toFixed(10)+","+r.yx.toFixed(10)+f+r.xy.toFixed(10)+","+r.yy.toFixed(10)+g+r.dx.toFixed(10)+(m?"px,":",")+r.dy.toFixed(10)+(m?"px":"")+h},matrix3d:function(r){return r=r.m,"matrix3d("+r[0].toFixed(10)+","+r[1].toFixed(10)+",0,0,"+r[2].toFixed(10)+","+r[3].toFixed(10)+",0,0,0,0,1,0,"+r[4].toFixed(10)+","+r[5].toFixed(10)+",0,1)"},getScaleFromMatrix:function(r){if(!r)return 1;r=r.toLowerCase();var e=r.indexOf("matrix3d")>-1?"matrix3d(":"matrix(";return Number(r.substring(e.length,r.indexOf(",")))}}};var b;return e.add("esri-webgl",t),e.add("esri-webgl-high-precision-fragment",a),e.add("esri-webgl-vertex-shader-samplers",o),e.add("esri-webgl-element-index-uint",s),e});